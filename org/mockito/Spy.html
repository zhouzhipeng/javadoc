<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="zh">
<head>
<!-- Generated by javadoc (1.8.0_112) on Sat Sep 01 15:36:09 CST 2018 -->
<title>Spy</title>
<meta name="date" content="2018-09-01">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="Spy";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>您的浏览器已禁用 JavaScript。</div>
</noscript>
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.mockito</div>
<h2 title="注释类型 Spy" class="title">注释类型 Spy</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre><a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html?is-external=true" title="java.lang.annotation中的类或接口">@Retention</a>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Retention.html?is-external=true#value--" title="java.lang.annotation中的类或接口">value</a>=<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/RetentionPolicy.html?is-external=true#RUNTIME" title="java.lang.annotation中的类或接口">RUNTIME</a>)
 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Target.html?is-external=true" title="java.lang.annotation中的类或接口">@Target</a>(<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Target.html?is-external=true#value--" title="java.lang.annotation中的类或接口">value</a>=<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/ElementType.html?is-external=true#FIELD" title="java.lang.annotation中的类或接口">FIELD</a>)
 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/annotation/Documented.html?is-external=true" title="java.lang.annotation中的类或接口">@Documented</a>
public @interface <span class="memberNameLabel">Spy</span></pre>
<div class="block">Allows shorthand wrapping of field instances in an spy object.

 <p>
 Example:

 <pre class="code"><code class="java">
 public class Test{
    //Instance for spying is created by calling constructor explicitly:
    &#64;Spy Foo spyOnFoo = new Foo("argument");
    //Instance for spying is created by mockito via reflection (only default constructors supported):
    &#64;Spy Bar spyOnBar;
    &#64;Before
    public void init(){
       MockitoAnnotations.initMocks(this);
    }
    ...
 }
 </code></pre>
 <p>
 Same as doing:

 <pre class="code"><code class="java">
 Foo spyOnFoo = Mockito.spy(new Foo("argument"));
 Bar spyOnBar = Mockito.spy(new Bar());
 </code></pre>

 <p>
 <strong>A field annotated with &#064;Spy can be initialized explicitly at declaration point.
 Alternatively, if you don't provide the instance Mockito will try to find zero argument constructor (even private)
 and create an instance for you.
 <u>But Mockito cannot instantiate inner classes, local classes, abstract classes and interfaces.</u></strong>

 For example this class can be instantiated by Mockito :
 <pre class="code"><code class="java">public class Bar {
    private Bar() {}
    public Bar(String publicConstructorWithOneArg) {}
 }</code></pre>
 </p>

 <h4>Important gotcha on spying real objects!</h4>
 <ol>
 <li>Sometimes it's impossible or impractical to use <a href="../../org/mockito/Mockito.html#when-T-"><code>Mockito.when(Object)</code></a> for stubbing spies.
 Therefore for spies it is recommended to always use <code>doReturn</code>|<code>Answer</code>|<code>Throw()</code>|<code>CallRealMethod</code>
 family of methods for stubbing. Example:

 <pre class="code"><code class="java">
   List list = new LinkedList();
   List spy = spy(list);

   //Impossible: real method is called so spy.get(0) throws IndexOutOfBoundsException (the list is yet empty)
   when(spy.get(0)).thenReturn("foo");

   //You have to use doReturn() for stubbing
   doReturn("foo").when(spy).get(0);
 </code></pre>
 </li>

 <li>Mockito <b>*does not*</b> delegate calls to the passed real instance, instead it actually creates a copy of it.
 So if you keep the real instance and interact with it, don't expect the spied to be aware of those interaction
 and their effect on real instance state.
 The corollary is that when an <b>*unstubbed*</b> method is called <b>*on the spy*</b> but <b>*not on the real instance*</b>,
 you won't see any effects on the real instance.</li>

 <li>Watch out for final methods.
 Mockito doesn't mock final methods so the bottom line is: when you spy on real objects + you try to stub a final method = trouble.
 Also you won't be able to verify those method as well.
 </li>
 </ol>

 <p>
 <strong>One last warning :</strong> if you call <code>MockitoAnnotations.initMocks(this)</code> in a
 super class <strong>constructor</strong> then this will not work. It is because fields
 in subclass are only instantiated after super class constructor has returned.
 It's better to use &#64;Before.
 <strong>Instead</strong> you can also put initMocks() in your JUnit runner (&#064;RunWith) or use the built-in
 <a href="../../org/mockito/junit/MockitoJUnitRunner.html" title="org.mockito.junit中的类"><code>MockitoJUnitRunner</code></a>.
 </p>

 <p>Note that the spy won't have any annotations of the spied type, because CGLIB won't rewrite them.
 It may troublesome for code that rely on the spy to have these annotations.</p></div>
<dl>
<dt><span class="simpleTagLabel">从以下版本开始:</span></dt>
<dd>1.8.3</dd>
<dt><span class="seeLabel">另请参阅:</span></dt>
<dd><a href="../../org/mockito/Mockito.html#spy-T-"><code>Mockito.spy(Object)</code></a>, 
<a href="../../org/mockito/Mock.html" title="org.mockito中的注释"><code>Mock</code></a>, 
<code>InjectMocks</code>, 
<a href="../../org/mockito/MockitoAnnotations.html#initMocks-java.lang.Object-"><code>MockitoAnnotations.initMocks(Object)</code></a>, 
<a href="../../org/mockito/junit/MockitoJUnitRunner.html" title="org.mockito.junit中的类"><code>MockitoJUnitRunner</code></a></dd>
</dl>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
</body>
</html>
